### 프로젝트 생성

+) 이번에는 Packaging을 Jar를 사용한다. JSP를 사용하지 않기 때문에 Jar를 사용하는 것이 좋다. <br/>
Jar를 사용하면 항상 내장 서버(톰캣 등)을 사용하고, webapp 경로도 사용하지 않는다. <br/>
즉, 내장 서버 사용에 최적화 되어 있는 기능이다. 최근에는 주로 이 방식을 사용한다.

War 역시 내장 서버 사용이 가능하지만, 주로 외부 서버에 배포하는 목적으로 사용한다.

+) 참고로 Jar를 사용하면 /resources/static/index.html 파일을 두면 Welcome Page로 처리해준다. <br/>
(스프링 부트가 지원하는 정적 컨텐츠 위치이다.)

<br/>

---

<br/>

### 요청 매핑

<br/>

```java

@RequestMapping(value = "/hello-basic")
public String helloBasic() {
  log.info("helloBasic");
  return "ok";
}

```

기본적인 요청 매핑(@RequestMapping)이다. /hello-basic URL 호출이 오면 이 메서드가 실행되도록 매핑한다.

+) 대부분의 속성을 배열로 제공하므로 다중 설정이 가능하다. -> {"/hello-baisc", "/hello-go"}

요청 매핑의 간단한 예제를 살펴보았는데 지금부터 요청 매핑이 제공하는 다양한 속성들에 대해 알아보자. <br/>
테스트는 대부분 Postman으로 진행한다.

<br/>

* HTTP 메서드 매핑

```java

/**
 * method 특정 HTTP 메서드 요청만 허용
 * GET, HEAD, POST, PUT, PATCH, DELETE
 */
@RequestMapping(value = "/mapping-get-v1", method = RequestMethod.GET)
public String mappingGetV1() {
   log.info("mappingGetV1");
   return "ok";
}

```

GET 방식 매핑이다. 만약 여기에 POST 요청을 하면 스프링 MVC는 405 상태코드를 반환한다.

+) 특히 @RestController에서 오류 발생 시 스프링이 상태 코드 등의 오류 내용을 
HTTP 메시지 바디에 json 형식으로 넣어준다. (Accept 헤더에 따라 형식이 달라진다.) <br/>

<br/>

* HTTP 메서드 매핑 축약

```java

/**
* 편리한 축약 애노테이션
* @GetMapping
* @PostMapping
* @PutMapping
* @DeleteMapping
* @PatchMapping
*/
@GetMapping(value = "/mapping-get-v2")
public String mappingGetV2() {
    log.info("mapping-get-v2");
    return "ok";
}

```

메서드를 일일이 매핑하지 않고 @GetMapping을 통해 축약한 애노테이션을 사용하는 것이 더 직관적이다. 
@GetMapping도 결국 내부를 보면 @RequestMapping에 method를 지정해서 사용한다. <br/>

<br/>

* PathVariable(경로 변수) 사용

```java

/**
* PathVariable 사용
* 변수명이 같으면 생략 가능
* @PathVariable("userId") String userId -> @PathVariable userId
*/
@GetMapping("/mapping/{userId}")
public String mappingPath(@PathVariable("userId") String data) {
    log.info("mappingPath userId={}", data);
    return "ok";
}


```


최근 HTTP API는 다음과 같이 리소스 경로에 식별자를 넣는 스타일을 선호한다.

ex) mapping/userA, /users/1

@PathVariable을 통해 URL 경로와 매칭되는 부분을 편리하게 조회할 수 있다.

@PathVariable("userId") String data -> @PathVariable String userId 처럼 이름과 파라미터 이름이 같으면 괄호 내용을 생략할 수 있다.

<br/>

* PathVariable 사용 - 다중

```java

/**
* PathVariable 사용 다중
*/
@GetMapping("/mapping/users/{userId}/orders/{orderId}")
public String mappingPath(@PathVariable String userId, @PathVariable Long
orderId) {
    log.info("mappingPath userId={}, orderId={}", userId, orderId);
    return "ok";
}

```

<br/>

* 특정 파라미터 조건 매핑

```java

/**
* 파라미터로 추가 매핑
* params="mode",
* params="!mode"
* params="mode=debug"
* params="mode!=debug" (! = )
* params = {"mode=debug","data=good"}
*/
@GetMapping(value = "/mapping-param", params = "mode=debug")
public String mappingParam() {
    log.info("mappingParam");
    return "ok";
}

```

http://localhost:8080/mapping-param?mode=debug 처럼 특정 쿼리 파라미터에 대해 매핑을 하는 방식이다. <br/>
앞서 말했듯이 최근에는 리소스 경로를 통해 파라미터를 받는 방식을 선호하기 때문에 잘 사용하지는 않는다.

<br/>

* 특정 헤더 조건 매핑

```java

/**
* 특정 헤더로 추가 매핑
* headers="mode",
* headers="!mode"
* headers="mode=debug"
* headers="mode!=debug" (! = )
*/
@GetMapping(value = "/mapping-header", headers = "mode=debug")
public String mappingHeader() {
    log.info("mappingHeader");
    return "ok";
}

```

HTTP 헤더를 통한 매핑이다. 해당 URL로 접근해도 헤더에 mode=debug가 포함되지 않았다면 매핑되지 않는다. <br/>
따라서 Postman으로 테스트할 때 다음과 같이 필요한 헤더를 추가해 주어야 한다.

![image](https://user-images.githubusercontent.com/78454649/173515778-8676d24a-df55-4b6b-967a-8fdd937674d3.png)

<br/>

* 미디어 타입 조건 매핑 - HTTP 요청 Content-Type, consume

```java

/**
* Content-Type 헤더 기반 추가 매핑 Media Type
* consumes="application/json"
* consumes="!application/json"
* consumes="application/*"
* consumes="*\/*"
* MediaType.APPLICATION_JSON_VALUE
*/
@PostMapping(value = "/mapping-consume", consumes = MediaType.APPLICATION_JSON_VALUE)
public String mappingConsumes() {
    log.info("mappingConsumes");
    return "ok";
}

```

HTTP 요청의 Content-Type 헤더를 기반으로 미디어 타입으로 매핑한다. 만약 맞지 않으면 415 상태코드를 반환한다.

+) Content-Type의 경우 header 속성을 사용하지 않고 이처럼 consumes를 사용한다.

![image](https://user-images.githubusercontent.com/78454649/173515902-f2f0b810-825a-4643-826b-0a2532119b22.png)


<br/>

---

<br/>






